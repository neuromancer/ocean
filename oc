#!/usr/bin/python2.7

import sys
import os

from Detection import GetArgs, GetFiles, GetCmd
from Mutation  import RandomMutator
from Run       import Runner

def Unbz2(filename):
  dirf = filename.replace(".tar.bz2","")

  #os.system("tar -xf "+ filename)
  #os.system("rm -f -R "+dirf)
  return dirf
  
target = sys.argv[1]
dirf = Unbz2(target)
os.chdir(dirf)
r = GetCmd(None) + " "

os.chdir("crash")
f = lambda i: i.PrepareData()

args = GetArgs()
files = GetFiles()
mutator = RandomMutator(args[1])

for i in range(0):
  mutator.Mutate()

args[0] = mutator.Mutate()

r = r + " \"" + " ".join(map(f,args)) + " " + "".join(map(f,files)) + " > /dev/null 2> /dev/null\""

print r
Runner(["ocean",r] , 5).Run()

exit(0)
#os.system(r)

with open('getdata.sh', 'w') as f:
  f.write(r)
  os.chmod("getdata.sh",0777)

name = dirf.replace("-report","")
os.system("printf "+name+",; ./getdata.sh > /dev/null; cat ocean.csv")

#os.close(f)

#x = open("crash.sh").read()


#patchCrash()


